
<!DOCTYPE html>
<html>
  <head>
    <!-- test change test the order of these does matter -->
    <title>Forest Change Assessment Viewer (OpenLayers Version)</title>
    <meta http-equiv="X-UA-Compatible" content="IE=8" >
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!--<script type="text/javascript" src="libs/jquery18/jquery-1.8.2.js"></script>-->
    <script type="text/javascript" src="libs/multigraph/multigraph.js"></script>

    <script type="text/javascript" src="libs/jquery17/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="libs/OpenLayers212/lib/OpenLayers.js"></script>
    <script type="text/javascript" src="listAccordion.js"></script>
    <link type="text/css" rel="stylesheet" href="libs/jquery18/themes/base/jquery.ui.all.css" />
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.core.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.mouse.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.draggable.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.resizable.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.accordion.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.dialog.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.position.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.ui.slider.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.effects.core.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.effects.scale.js"></script>
    <script type="text/javascript" src="libs/jquery18/ui/jquery.effects.fold.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
    <link rel="stylesheet" type="text/css" href="NEMACStyle.css" />
    
    <script type="text/javascript">
        var map,
            streetsURL = "http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",
            imageryURL = "http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer";
        
        function changeBaseLayer(url) {
            $.ajax({
                url: url + '?f=json&pretty=true',
                dataType: "jsonp",
                success:  function (layerInfo) 
                          {
                            map.removeLayer(map.layers[0]);
                            var baseLayer = new OpenLayers.Layer.ArcGISCache("AGSCache", url, {
                                layerInfo: layerInfo
                            });
                            map.addLayers([baseLayer]);
                          }
            });        
        }
        
        function init() {
            var jsonp = new OpenLayers.Protocol.Script();
            jsonp.createRequest(streetsURL, {
                f: 'json', 
                pretty: 'true'
            }, initMap);
        }

        function initMap(layerInfo){
            var baseLayer = new OpenLayers.Layer.ArcGISCache("AGSCache", streetsURL, {
                layerInfo: layerInfo
            });
            
            map = new OpenLayers.Map('map', { 
                maxExtent: baseLayer.maxExtent,
                units: baseLayer.units,
                resolutions: baseLayer.resolutions,
                numZoomLevels: baseLayer.numZoomLevels,
                tileSize: baseLayer.tileSize,
                displayProjection: baseLayer.displayProjection  
            });
            map.addLayers([baseLayer]);
            map.addControl(new OpenLayers.Control.MousePosition() );            
            map.zoomToExtent(new OpenLayers.Bounds(-8725663.6225564, 4683718.6735907, -8099491.4868444, 4996804.7414467));
            
            $('#baseCombo').change(function() {
                if ($("#baseCombo").val()=="streets"){
                    changeBaseLayer(streetsURL);
                }
                else {
                    changeBaseLayer(imageryURL);
                }
            });               
            
        }
    </script>
  </head>
  <body onload="init()">
    <div>
      <table width="100%" border="0">
        <tr>
	      <td align="right">
            <div id='mapBase' style="display:inline-block;vertical-align:top;">
              <b>Base Map:</b> 
                <select id="baseCombo">
                    <option value="streets">streets</option>
                    <option value="imagery">imagery</option>
                </select>
	       </div>
	      </td>
	    </tr>
      </table>            
    </div>
    <div id="map" class="smallmap"></div>
  </body>
</html>
